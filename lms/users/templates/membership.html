{% extends 'base.html' %}

{% block header %}
<style>
.membership-card {
    transition: all 0.3s ease;
    cursor: pointer;
}
.membership-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}
.membership-card.selected {
    border-color: #4f46e5;
    box-shadow: 0 10px 25px rgba(79, 70, 229, 0.2);
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
}
.membership-card.popular {
    position: relative;
    border-color: #10b981;
}
.popular-badge {
    position: absolute;
    top: -8px;
    right: 20px;
    background: #10b981;
    color: white;
    padding: 4px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}
.feature-check {
    color: #10b981;
}
.billing-toggle {
    background: #f1f5f9;
    border-radius: 50px;
    padding: 4px;
    display: inline-flex;
    margin: 20px 0;
}
.billing-option {
    padding: 8px 20px;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 500;
}
.billing-option.active {
    background: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    color: #1f2937;
}
.discount-badge {
    background: #fef3c7;
    color: #92400e;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    margin-left: 8px;
}
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-12 max-w-7xl">
    <!-- Header Section -->
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">Membership Plans</h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
            Choose the perfect membership plan for your reading needs. 
            Unlock unlimited access to our extensive library collection.
        </p>
        
        <!-- Billing Toggle -->
        <div class="flex justify-center mt-8">
            <div class="billing-toggle">
                <div class="billing-option active" id="monthly-toggle">Monthly</div>
                <div class="billing-option" id="annual-toggle">
                    Annual 
                    <span class="discount-badge">Save 17%</span>
                </div>
            </div>
        </div>
    </div>

    <form method="post" id="membership-form">
        {% csrf_token %}
        
        <!-- Membership Cards Grid -->
        <div class="grid grid-cols-1 md:grid-cols-{{ membership_types|length }} gap-8 mb-8">
            {% for membership_type in membership_types %}
            <!-- {{ membership_type.name }} Plan -->
            <div class="membership-card bg-white rounded-xl border-2 border-gray-200 p-8 hover:border-indigo-300 {% if forloop.last and membership_types|length >= 3 %}popular border-green-400{% endif %}" 
                 data-plan="{{ membership_type.id }}">
                
                {% if forloop.last and membership_types|length >= 3 %}
                <div class="popular-badge">Most Popular</div>
                {% endif %}
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-500 uppercase tracking-wide mb-2">{{ membership_type.name }}</h3>
                    <div class="price-container">
                        <span class="text-4xl font-bold text-gray-900 monthly-price">{{ membership_type.monthly_fee|floatformat:0 }}</span>
                        <span class="text-4xl font-bold text-gray-900 annual-price hidden">{{ membership_type.annual_fee|floatformat:0 }}</span>
                        <span class="text-gray-500 ml-2 billing-period">MVR / month</span>
                    </div>
                    <p class="text-gray-600 mt-2">
                        {% if 'Student' in membership_type.name %}Perfect for students
                        {% elif 'Basic' in membership_type.name %}Great for casual readers
                        {% elif 'Premium' in membership_type.name %}Best for avid readers
                        {% else %}Choose your reading experience{% endif %}
                    </p>
                </div>
                
                <ul class="space-y-3 mb-8">
                    <li class="flex items-center">
                        <i class="fas fa-check feature-check mr-3"></i>
                        <span>Borrow up to {{ membership_type.max_books }} books</span>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-check feature-check mr-3"></i>
                        <span>{{ membership_type.loan_period_days }}-day loan period</span>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-check feature-check mr-3"></i>
                        <span>Full catalog access</span>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-check feature-check mr-3"></i>
                        <span>Email notifications</span>
                    </li>
                    {% if membership_type.extension_days > 0 %}
                    <li class="flex items-center">
                        <i class="fas fa-check feature-check mr-3"></i>
                        <span>{{ membership_type.extension_days }}-day loan extensions</span>
                    </li>
                    {% endif %}
                    {% if 'Student' in membership_type.name %}
                    <li class="flex items-center">
                        <i class="fas fa-graduation-cap feature-check mr-3"></i>
                        <span>Student discount rate</span>
                    </li>
                    {% elif 'Premium' in membership_type.name %}
                    <li class="flex items-center">
                        <i class="fas fa-check feature-check mr-3"></i>
                        <span>Priority reservations</span>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-check feature-check mr-3"></i>
                        <span>Digital resources access</span>
                    </li>
                    {% else %}
                    <li class="flex items-center">
                        <i class="fas fa-check feature-check mr-3"></i>
                        <span>Standard borrowing</span>
                    </li>
                    {% endif %}
                </ul>
                
                <input type="radio" name="selected_plan" value="{{ membership_type.id }}" class="plan-radio hidden" />
                <button type="button" class="select-plan-btn w-full py-3 px-6 {% if forloop.last and membership_types|length >= 3 %}bg-green-500 text-white hover:bg-green-600{% else %}border-2 border-gray-300 text-gray-700 hover:border-indigo-500 hover:text-indigo-600{% endif %} font-semibold rounded-lg transition duration-200">
                    Get Started
                </button>
            </div>
            {% empty %}
            <div class="col-span-full text-center py-12">
                <div class="text-gray-500">
                    <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">No Membership Plans Available</h3>
                    <p>Please contact the library administration for membership options.</p>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Action Button -->
        <div class="text-center">
            <button type="submit" id="confirm-selection" class="hidden bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-4 px-8 rounded-lg text-lg transition duration-200 shadow-lg">
                <i class="fas fa-credit-card mr-2"></i>
                Confirm Selection
            </button>
        </div>
    </form>

    <!-- Current Membership Status -->
    {% if user.membership %}
    <div class="mt-12 bg-blue-50 border border-blue-200 rounded-lg p-6">
        <div class="flex items-center">
            <i class="fas fa-info-circle text-blue-500 mr-3"></i>
            <div>
                <h4 class="font-semibold text-blue-900">Current Membership</h4>
                <p class="text-blue-700">You currently have a <strong>{{ user.membership.name }}</strong> membership.</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const membershipCards = document.querySelectorAll('.membership-card');
    const confirmBtn = document.getElementById('confirm-selection');
    const monthlyToggle = document.getElementById('monthly-toggle');
    const annualToggle = document.getElementById('annual-toggle');
    const monthlyPrices = document.querySelectorAll('.monthly-price');
    const annualPrices = document.querySelectorAll('.annual-price');
    const billingPeriods = document.querySelectorAll('.billing-period');
    
    let selectedPlan = null;
    let isAnnual = false;

    // Handle billing period toggle
    monthlyToggle.addEventListener('click', function() {
        if (isAnnual) {
            isAnnual = false;
            monthlyToggle.classList.add('active');
            annualToggle.classList.remove('active');
            
            monthlyPrices.forEach(price => price.classList.remove('hidden'));
            annualPrices.forEach(price => price.classList.add('hidden'));
            billingPeriods.forEach(period => period.textContent = 'MVR / month');
        }
    });

    annualToggle.addEventListener('click', function() {
        if (!isAnnual) {
            isAnnual = true;
            annualToggle.classList.add('active');
            monthlyToggle.classList.remove('active');
            
            annualPrices.forEach(price => price.classList.remove('hidden'));
            monthlyPrices.forEach(price => price.classList.add('hidden'));
            billingPeriods.forEach(period => period.textContent = 'MVR / year');
        }
    });

    // Handle card selection
    membershipCards.forEach(card => {
        card.addEventListener('click', function() {
            // Remove selected class from all cards
            membershipCards.forEach(c => {
                c.classList.remove('selected');
                c.querySelector('.plan-radio').checked = false;
                const btn = c.querySelector('.select-plan-btn');
                
                // Reset button based on card styling
                if (c.classList.contains('popular')) {
                    btn.textContent = 'Get Started';
                    btn.className = 'select-plan-btn w-full py-3 px-6 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition duration-200';
                } else {
                    btn.textContent = 'Get Started';
                    btn.className = 'select-plan-btn w-full py-3 px-6 border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:border-indigo-500 hover:text-indigo-600 transition duration-200';
                }
            });
            
            // Add selected class to clicked card
            this.classList.add('selected');
            this.querySelector('.plan-radio').checked = true;
            selectedPlan = this.dataset.plan;
            
            // Update button text
            const btn = this.querySelector('.select-plan-btn');
            btn.innerHTML = '<i class="fas fa-check mr-2"></i>Selected';
            
            // Show confirm button
            confirmBtn.classList.remove('hidden');
        });
    });

    // Handle form submission
    document.getElementById('membership-form').addEventListener('submit', function(e) {
        if (!selectedPlan) {
            e.preventDefault();
            alert('Please select a membership plan');
        }
    });
});
</script>

{% endblock %}